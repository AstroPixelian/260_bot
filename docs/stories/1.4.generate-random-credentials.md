# Story 1.4: 生成随机的账户凭证

## Status
Approved

## Story
**作为一名** 开发者,
**我想要** 一个可以指定数量的功能，来生成随机的、符合基本格式要求的用户名和密码,
**以便于** 我能快速创建用于批量注册的测试数据，而无需手动编写。

## Acceptance Criteria
1. CLI或程序内函数可以接受一个整数 `N` 作为输入。
2. 程序能生成 `N` 组唯一的用户名和密码。
3. 生成的用户名应为随机字符串，以降低重名概率（例如 `user_f8b3d`）。
4. 生成的密码应为包含字母和数字的随机字符串（例如长度为10位）。
5. 生成的凭证列表能被打印到控制台或输出到文件中。
6. 每条凭证的输出格式严格为 `"账号 --- 密码"`。

## Tasks / Subtasks
- [ ] Task 1: Enhance existing AccountGenerator CLI interface (AC: 1, 6)
  - [ ] Modify main.py to support new CLI argument for account generation
  - [ ] Add argparse support for `--generate <N>` parameter
  - [ ] Ensure proper output formatting matches required "账号 --- 密码" format
  - [ ] Handle invalid inputs and edge cases with appropriate error messages

- [ ] Task 2: Improve username generation for better uniqueness (AC: 2, 3)
  - [ ] Review and enhance existing AccountGenerator.generate_username() method
  - [ ] Ensure usernames follow the pattern with random strings for uniqueness
  - [ ] Add collision detection to prevent duplicate usernames in a single batch
  - [ ] Test username generation with various counts to verify uniqueness

- [ ] Task 3: Enhance password generation to meet requirements (AC: 4)
  - [ ] Review existing AccountGenerator.generate_password() method
  - [ ] Ensure passwords contain both letters and numbers as minimum requirement
  - [ ] Configure appropriate password length range (default around 10 characters)
  - [ ] Validate password complexity meets basic security standards

- [ ] Task 4: Implement console output formatting (AC: 5, 6)
  - [ ] Modify output logic to use exact format "账号 --- 密码"
  - [ ] Ensure proper console display with numbered list
  - [ ] Add option to output to file when requested
  - [ ] Implement clean, readable output formatting

- [ ] Task 5: Integration with main CLI entry point (AC: 1)
  - [ ] Integrate account generation functionality with main.py CLI routing
  - [ ] Add detection for generation-specific arguments
  - [ ] Ensure backward compatibility with existing CLI functionality
  - [ ] Test integration between different CLI modes

- [ ] Task 6: Add comprehensive unit tests
  - [ ] Create test file `tests/unit/test_account_generation.py`
  - [ ] Test username uniqueness within batches
  - [ ] Test password complexity requirements
  - [ ] Test output formatting matches exact specification
  - [ ] Test edge cases and error handling

## Dev Notes

### Previous Story Insights
Key learnings from Story 1.3:
- CLI interface successfully implemented using argparse with main.py routing
- AutomationService integration pattern established using callback system
- Account model exists at `src/models/account.py` with proper status tracking
- Translation system (tr function) available for internationalization
- Error handling patterns established for CLI operations

### Technical Context
- **Existing AccountGenerator**: Already exists at `src/account_generator.py` with core generation logic [Source: current codebase analysis]
- **Current Functionality**: The generator already has username and password generation methods using Faker library
- **CLI Integration Needed**: Must integrate with main.py CLI routing system established in Story 1.3
- **CLI Parameter Details**: Add `--generate <N>` argument to main.py CLI detection logic alongside existing `--username` and `--password` parameters
- **Integration Pattern**: Follow same pattern as Story 1.3 where main.py detects specific arguments and routes to appropriate handler
- **Expected Command**: `python main.py --generate 10` should output 10 accounts in "账号 --- 密码" format

### Source Tree Information
Based on project structure [Source: architecture/source-tree.md]:
- **Main Entry Point**: `main.py` - Application entry with CLI/GUI mode detection 
- **Generator Location**: `src/account_generator.py` - Contains AccountGenerator class
- **Test Location**: `tests/` directory for unit tests
- **Output Directory**: `output/` directory for generated files

### Data Models
- **Account Model**: Located at `src/models/account.py` - Contains Account class with status tracking [Source: architecture/data-models.md]
- **Generator Output**: Currently returns list[dict] with 'username' and 'password' keys
- **Required Format**: Must output "账号 --- 密码" format as specified in AC #6

### Technical Specifications
- **Technology Stack**: Python 3.12, faker library for realistic data generation [Source: architecture/tech-stack.md]
- **Architecture Pattern**: MVVM model with service layer pattern
- **CLI Framework**: argparse for command line argument parsing
- **File Operations**: Path and CSV handling for output functionality

### Testing Requirements
Based on testing strategy [Source: architecture/test-strategy.md]:
- **Unit Tests**: Individual component testing for generation logic
- **Integration Tests**: End-to-end CLI workflow testing
- **Test File Location**: `tests/unit/test_account_generation.py`
- **Testing Framework**: pytest as established in project standards

### Implementation Constraints
- **Existing Code**: Must enhance existing AccountGenerator rather than replacing it
- **CLI Integration**: Must work with established main.py routing system from Story 1.3
- **Output Format**: Strict adherence to "账号 --- 密码" format requirement
- **Backward Compatibility**: Cannot break existing functionality

### Project Structure Alignment
- Generator enhancement should maintain existing patterns in `src/account_generator.py`
- CLI integration follows established pattern in `main.py` from Story 1.3
- Test files follow existing structure under `tests/unit/`
- No conflicts identified with current project structure

## Testing
### Testing Standards
Based on architecture testing strategy [Source: architecture/test-strategy.md]:
- **Test File Location**: `tests/unit/test_account_generation.py`
- **Testing Framework**: pytest framework as established in tech stack
- **Pytest Execution Commands**: 
  - `pytest tests/unit/test_account_generation.py -v` (verbose test execution)
  - `pytest tests/unit/test_account_generation.py::test_username_uniqueness` (specific test)
  - `pytest tests/unit/ -k account_generation` (pattern matching)
- **Coverage Requirements**: Unit tests for generation logic, CLI integration tests
- **Test Categories**: 
  - Unit tests for AccountGenerator methods
  - Integration tests for CLI workflow  
  - Edge case testing for input validation
  - Output format validation tests
- **Test Patterns**: Mock external dependencies, isolated component testing

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-31 | 1.0 | Initial story creation based on Epic 1.4 requirements | Scrum Master Bob |

## Dev Agent Record
*This section is populated by the development agent during implementation*

### Agent Model Used
*To be populated by dev agent with specific AI agent model and version used for development*

### Implementation Summary
*To be populated by dev agent with overview of implementation approach and results*

### Debug Log References
*To be populated by dev agent with references to any debug logs or traces generated during development*

### Completion Notes
*To be populated by dev agent with notes about completion of tasks and any issues encountered*

### File List
*To be populated by dev agent with list of all files created, modified, or affected during story implementation*

### Technical Implementation Details
*To be populated by dev agent with specific technical decisions and implementation patterns used*

### Change Log
*To be populated by dev agent with implementation-specific changes*

## QA Results
*Results from QA Agent review of the completed story implementation*