# **产品需求文档(PRD): 360账号批量注册工具**

**版本: 2.0 - 最终实现版本**

## **1. 目标与背景 (Goals and Background Context)**

  * **目标 (Goals)**
      * 将批量注册100个账号所需的时间从数小时缩短到几分钟。
      * 为需要批量操作的专业用户（市场、测试、游戏工作室）提供一款无需编程的自动化工具。
      * 为个人用户提供一种创建少量备用账户的便捷方式。
      * 确保工具的注册成功率高于90%（在无外部阻碍的情况下）。
  * **背景 (Background Context)**
      * 本项目旨在解决在 `wan.360.cn` 网站上手动注册账号效率低下的核心痛点。当前的手动流程耗时、重复且易错，直接影响了依赖大量账号进行业务操作的用户的生产力。现有通用自动化工具门槛较高，需要编程知识。因此，开发一款专用的、带有图形用户界面的批量注册工具，能精准填补市场空白，为目标用户提供直接的价值。
  * **变更日志 (Change Log)**
    | 日期 | 版本 | 描述 | 作者 |
    | :--- | :--- | :--- | :--- |
    | 2025年8月30日 | 1.0 | 初始PRD创建 | John (PM) |
    | 2025年8月31日 | 2.0 | 更新为最终实现版本，反映MVVM架构、多语言支持、密码管理功能 | Claude |

## **2. 需求 (Requirements)**

  * **功能性需求 (Functional Requirements)**
      * FR1: 应用程序必须提供一个图形用户界面(GUI)以供用户交互。
      * FR2: 用户必须能够通过GUI导入或输入一个包含待注册账户信息（如用户名、密码）的列表。
      * FR3: 用户必须能够通过GUI启动、暂停和停止批量注册任务。
      * FR4: 应用程序必须能够自动访问 `wan.360.cn` 网站，并使用用户提供的数据填写并提交注册表单。🔄 **架构就绪** - 使用模拟实现，Playwright框架预留
      * FR5: 应用程序必须在界面上实时显示批量任务的进度，包括总任务数、成功数和失败数。
      * FR6: 任务完成后，应用程序必须能生成一份报告，详细说明每个账户的注册状态（成功或失败）以及失败的原因（如果可能）。
      * FR7: 当检测到需要手动干预的验证码时，应用程序必须暂停任务，并提示用户输入验证码以继续。🔄 **架构预留** - 预留接口，未实现具体逻辑
      * FR8: GUI界面必须以列表形式展示所有待处理和已处理的账户，并清晰地标示出每个账户当前的注册状态（如：排队中、正在注册、成功、失败）。
      * FR9: 用户必须能够通过GUI将包含所有账户及其最终注册状态的清单导出为文件（例如CSV格式）。
      * FR10: 应用程序必须支持多语言界面（中文和英文），用户可以在运行时切换语言。
      * FR11: 账户密码必须支持星号显示、明文切换和一键复制功能，用户名也支持一键复制。
  * **非功能性需求 (Non-Functional Requirements)**
      * NFR1: 应用程序必须能在 Windows 10 及更高版本的操作系统上运行。
      * NFR2: 新用户应能在无帮助文档的情况下，在5分钟内理解核心功能并开始注册任务。
      * NFR3: 应用程序应能妥善处理常见的网络延迟或网站加载缓慢问题，而不会轻易崩溃。🔄 **架构就绪** - 异常处理框架已建立
      * NFR4: 用户的账户数据列表必须仅存储在本地计算机上。
      * NFR5: 自动化逻辑应设计为模块化，以便在目标网站前端结构发生变化时，能更容易地进行维护和更新。
      * NFR6: 应用程序架构必须遵循MVVM设计模式，确保UI与业务逻辑完全分离。
      * NFR7: 界面必须支持响应式更新，通过信号槽机制实现实时状态同步。

## **3. 用户界面设计目标 (User Interface Design Goals)**

  * **整体用户体验愿景 (Overall UX Vision)**
      * 界面设计应追求极致的 **简洁、清晰、高效**。用户应能通过界面直观地理解和控制整个批量注册流程。
  * **核心屏幕与视图 (Core Screens and Views)**
      * **主应用窗口**: 作为一个专用工具，所有功能将集成在单一的主窗口中。
        **基础界面原型:**
        ```
        +-----------------------------------------------------------------------------+
        | 360 Batch Account Creator                       [EN] [中文]      [_] [口] [X] |
        +-----------------------------------------------------------------------------+
        | [导入CSV] [随机生成] [开始处理] [暂停] [停止] [导出结果] [清空列表] [重置状态] |
        +-----------------------------------------------------------------------------+
        | 进度: [==========] 45% | 总计: 20 成功: 8 失败: 1 处理中: 1 排队中: 10      |
        +-----------------------------------------------------------------------------+
        | 账户列表                                                                     |
        |-----------------------------------------------------------------------------|
        | 用户名           | 密码        | 状态    | 备注                             |
        |------------------|-------------|---------|----------------------------------|
        | user_abc_001 📋  | ******* 👁️📋 | ✅ 成功 | 注册成功                         |
        | user_abc_002 📋  | ******* 👁️📋 | ❌ 失败 | 用户名已被占用                   |
        | user_abc_003 📋  | ******* 👁️📋 | 🔄 处理中 |                                |
        | ...              | ...         | ...     | ...                              |
        +-----------------------------------------------------------------------------+
        | 日志输出                                                                     |
        |-----------------------------------------------------------------------------|
        | [21:12:04] INFO: 应用启动 - 准备导入或生成账户                               |
        | [21:13:15] INFO: 成功导入20个账户                                           |
        | [21:13:45] INFO: 开始批量处理20个账户                                       |
        | [21:14:02] SUCCESS: user_abc_001 注册成功                                  |
        +-----------------------------------------------------------------------------+
        ```
        
        **🎯 设计亮点:**
        - **多语言支持**: 右上角语言切换按钮（图标显示）
        - **密码安全**: 星号显示，眼睛图标切换明文
        - **便捷复制**: 用户名和密码都有复制按钮 📋
        - **状态可视化**: 彩色图标 + 文字状态显示
        - **实时更新**: 进度条和统计数据实时更新
        - **完整控制**: 8个功能按钮覆盖所有操作
  * **目标设备与平台 (Target Device and Platforms)**
      * **平台: 桌面端**。根据需求NFR1，此应用为Windows 10/11桌面应用程序。

## **4. 技术假设**

  * **仓库结构 (Repository Structure): Polyrepo**
  * **服务架构 (Service Architecture): MVVM模式的单体应用** 
  * **测试要求 (Testing Requirements): 架构预留**
  * **最终技术栈 (Final Tech Stack)**
      * **编程语言**: **Python 3.12**
      * **GUI框架**: **PySide6 (Qt6)**
      * **架构模式**: **MVVM (Model-View-ViewModel)**
      * **国际化**: **Qt Linguist (.ts/.qm文件)**
      * **浏览器自动化**: **Playwright** 🔄 **架构预留** - 服务层已预留接口
      * **依赖管理**: **uv**
      * **打包与分发**: **Nuitka** 🔄 **计划中** - 可执行文件打包
  * **架构特色 (Architecture Highlights)**
      * **MVVM模式**: Model层(数据模型) → ViewModel层(业务逻辑) → View层(UI界面)
      * **Service层模式**: DataService(数据操作) + AutomationService(自动化流程) 
      * **信号槽机制**: Qt原生的响应式UI更新机制
      * **模块化设计**: 高内聚低耦合，便于维护和扩展

## **5. 开发阶段划分**

### 史诗 1: 核心自动化引擎与基础架构 (Core Automation Engine & Infrastructure)

**史诗目标**: 建立一个稳定的项目基础，并实现核心的自动化注册逻辑。完成时，我们将拥有一个可以通过命令行进行测试的自动化“引擎”，为后续的GUI开发铺平道路。

#### 用户故事 1.1: 项目初始化与依赖设置
**作为一名** 开发者,
**我想要** 初始化一个包含标准结构和已配置好依赖（uv, Playwright）的Python项目,
**以便于** 我有一个干净、可复现的基础来开始构建。

**验收标准**:
1.  项目已初始化为Git仓库。
2.  uv环境已创建，Playwright等核心依赖已安装。
3.  项目包含基础的目录结构（例如 `src`, `tests`）。
4.  Playwright所需的浏览器驱动已正确安装。

#### 用户故事 1.2: 实现单账户注册逻辑
**作为一个** 系统,
**我想要** 接收一个用户名和密码，并用它自动导航到 `wan.360.cn` 的注册页面完成表单填写和提交,
**以便于** 验证核心的、理想情况下的自动化注册流程是可行的。

**验收标准**:
1.  程序中有一个函数/类，可以接收账户信息作为参数。
2.  该函数能成功启动Playwright并打开目标注册页面。
3.  它能准确地在对应的输入框中填入用户名和密码。
4.  它能成功点击注册按钮。
5.  (假设) 此故事的测试可以暂时忽略复杂的验证码环节。

#### 用户故事 1.3: 创建基础的命令行接口 (CLI)
**作为一名** 开发者,
**我想要** 一个简单的命令行接口，让我可以传入用户名和密码来调用注册逻辑并看到结果,
**以便于** 我能在没有完整GUI的情况下，方便地测试和演示核心引擎的功能。

**验收标准**:
1.  可以通过命令行运行脚本（例如 `python main.py --username test --password pass`）。
2.  CLI能正确调用故事1.2中实现的注册逻辑。
3.  注册成功时，命令行输出“Success”或类似成功信息。
4.  注册失败时，命令行输出“Error”或相关失败信息。

#### 用户故事 1.4: 生成随机的账户凭证
**作为一名** 开发者,
**我想要** 一个可以指定数量的功能，来生成随机的、符合基本格式要求的用户名和密码,
**以便于** 我能快速创建用于批量注册的测试数据，而无需手动编写。

**验收标准**:
1.  CLI或程序内函数可以接受一个整数 `N` 作为输入。
2.  程序能生成 `N` 组唯一的用户名和密码。
3.  生成的用户名应为随机字符串，以降低重名概率（例如 `user_f8b3d`）。
4.  生成的密码应为包含字母和数字的随机字符串（例如长度为10位）。
5.  生成的凭证列表能被打印到控制台或输出到文件中。
6.  每条凭证的输出格式严格为 `“账号 --- 密码”`。

#### 用户故事 1.5: 基础的错误与异常处理
**作为一个** 系统,
**我想要** 在自动化过程中优雅地处理常见错误（如页面加载失败、元素未找到）,
**以便于** 提升自动化脚本的稳定性，并为失败提供有意义的反馈。

**验收标准**:
1.  Playwright的关键操作被包含在try-except块中。
2.  当找不到关键页面元素时，程序能捕获异常并报告“元素未找到”的错误。
3.  当注册因已知原因（如“用户名已被占用”）失败时，程序能识别并返回具体原因。
4.  故事1.3的CLI能显示这些具体的错误信息。

### 史诗 2: 交互式图形界面与用户控制 (Interactive GUI & User Controls)

**史诗目标**: 在核心引擎的基础上，构建一个功能完整、用户友好的图形界面。完成时，用户将能通过点击按钮、导入文件等可视化操作，轻松完成批量注册任务，并获得清晰的实时反馈和最终报告。

#### 用户故事 2.1: 基础GUI窗口与布局
**作为一名** 用户,
**我想要** 看到应用程序的主窗口及所有核心功能区域的布局,
**以便于** 我对工具的整体结构有一个直观的认识。

**验收标准**:
1.  应用程序启动时显示主窗口。
2.  窗口中包含按钮区、进度区、账户列表区和日志区的占位布局。
3.  窗口可以被缩放和关闭。

#### 用户故事 2.2: 实现数据导入功能
**作为一名** 用户,
**我想要** 点击“导入”按钮并选择一个CSV文件，将账户信息加载到界面列表中,
**以便于** 我能轻松准备大量待注册的账户。

**验收标准**:
1.  界面上有“导入”按钮。
2.  点击后能打开文件选择对话框。
3.  选择的CSV文件内容能被正确解析并显示在账户列表表格中。
4.  导入后，所有账户状态为“排队中”。

#### 用户故事 2.3: 连接GUI控件与核心引擎
**作为一名** 用户,
**我想要** 点击“开始”、“暂停”和“停止”按钮来控制批量注册过程,
**以便于** 我能完全掌控自动化任务的执行。

**验收标准**:
1.  “开始”、“暂停”、“停止”按钮功能可用。
2.  点击“开始”能启动注册流程。
3.  点击“暂停”能暂停任务，再次点击“开始”能恢复任务。
4.  点击“停止”能终止整个任务。

#### 用户故事 2.4: 在GUI中实现实时状态更新
**作为一名** 用户,
**我想要** 在任务运行时，实时看到账户列表和进度统计的变化,
**以便于** 我能随时了解任务的详细进展。

**验收标准**:
1.  正在注册的账户，其状态会更新为“正在注册...”。
2.  注册完成后，状态会更新为“成功”或“失败”。
3.  备注列会更新为失败原因（如果可能）。
4.  顶部的进度统计信息会实时更新。

#### 用户故事 2.5: 实现结果导出功能
**作为一名** 用户,
**我想要** 在任务完成后，点击“导出”按钮将最终的账户列表和状态保存为CSV文件,
**以便于** 我能获得一份可存档、可分享的结果报告。

**验收标准**:
1.  界面上有“导出”按钮。
2.  点击后能打开文件保存对话框。
3.  能将当前账户列表的所有内容（用户名、状态、备注）保存到用户指定的CSV文件中。

## 附录A： 账号注册流程

### 一些XPath供参考
> 网址：https://wan.360.cn/，搜索到以下XPath可以参考

#### 登录窗口
账号[输入框]: `/html/body/div/div/div[2]/div/div/div/div[2]/form/div[1]/div/div/input`
密码[输入框]: `/html/body/div/div/div[2]/div/div/div/div[2]/form/div[2]/div/div/input`
同意登录协议[单选框]: `/html/body/div/div/div[2]/div/div/div/div[2]/form/div[4]/div/label/input`
登录[按钮]: `/html/body/div/div/div[2]/div/div/div/div[2]/form/div[5]/input`
注册[按钮]: `/html/body/div/div/div[2]/div/div/div/div[2]/form/div[6]/div[2]/a[1]`

#### 注册窗口 （点击注册按钮等待3秒后出现）
注册用户名[输入框]: `/html/body/div[9]/div[2]/div/div/div/form/div[1]/div/div[1]/div/div/input`
初始密码[输入框]: `/html/body/div[9]/div[2]/div/div/div/form/div[1]/div/div[2]/div/div/input`
再次输入密码[输入框]: `/html/body/div[9]/div[2]/div/div/div/form/div[1]/div/div[3]/div/div/input`
同意注册协议[单选框]: `/html/body/div[9]/div[2]/div/div/div/form/div[2]/label/input`
确认注册[按钮]: `/html/body/div[9]/div[2]/div/div/div/form/div[3]/input`

#### 验证登录成功/注册成功 （注册成功会自动登录）
检查<a>标签的内容： `/html/body/div[1]/div/span[2]/a[2]`
<a>标签内容为 `[退出]` 证明当前“已成功登录账号”


### 账号注册流程

#### 基础流程说明
  1. 打开 https://wan.360.cn/
  2. 点击[注册按钮]
  3. 输入需要注册的账号、密码
  4. 同意注册协议
  5. 点击注册按钮
    5.1 等待几秒后验证当前为"已登录"状态，则代表注册成功
    5.2 如果弹出了验证码，则状态为"验证码识别中"，并提示用户操作（不使用弹出框等强提示，应该使用弱提示）
    5.3 每隔一秒检测是否还有验证码的弹窗，有则继续等待1秒并重新检测，没有则检测是否是"已登录"状态
  6. 流程结束

#### 状态机实现架构

系统已实现基于状态机的注册流程管理，提供清晰的状态转换和错误处理机制。

##### 状态机流转图

```
                    注册状态机流转图
                    ==================

    [初始化]
        │
        ▼
    [导航中] ────────────────┐
        │                   │
        ▼                   ▼
    [首页准备]           [错误状态]
        │                   ▲
        ▼                   │
    [打开表单] ──────────────┤
        │                   │
        ▼                   │
    [表单准备] ──────────────┤
        │                   │
        ▼                   │
    [填写表单] ──────────────┤
        │                   │
        ▼                   │
    [提交中] ────────────────┤
        │                   │
        ▼                   │
    [等待结果] ──────────────┘
        │
        ├─── 无验证码 ────────┐
        │                   │
        └─── 有验证码 ───────┐ │
                           │ │
                           ▼ │
                    [验证码待处理] │
                           │ │
                           ▼ │
                    [验证码监控] │
                           │ │
                    ┌──────┴──┐ │
                    ▼         │ │
              [验证码超时]     │ │
                    │         ▼ │
                    │   [验证成功]◄─┘
                    │         │
                    ▼         │
              [注册失败]◄──────┤
                              │
                              ▼
                        [注册成功]


    状态说明：
    - 方框 [ ] 表示状态
    - 箭头 → 表示状态转换
    - 分支点显示条件判断
    - 错误状态可从多个状态触发
```

##### 核心状态定义

| 状态名称 | 说明 | 主要操作 |
|---------|------|---------|
| `INITIALIZING` | 初始化浏览器和准备工作 | 系统初始化 |
| `NAVIGATING` | 导航到注册页面 | 打开wan.360.cn |
| `HOMEPAGE_READY` | 首页加载完成 | 准备点击注册按钮 |
| `OPENING_FORM` | 点击注册按钮 | 等待表单出现 |
| `FORM_READY` | 注册表单已出现 | 准备填写信息 |
| `FILLING_FORM` | 正在填写注册表单 | 填写用户名、密码等 |
| `SUBMITTING` | 提交注册表单 | 点击注册按钮 |
| `WAITING_RESULT` | 等待注册结果 | 检测验证码或成功状态 |
| `CAPTCHA_PENDING` | 检测到验证码 | 需要用户介入 |
| `CAPTCHA_MONITORING` | 监控验证码完成状态 | 实时监控用户操作 |
| `CAPTCHA_TIMEOUT` | 验证码处理超时 | 超时处理 |
| `VERIFYING_SUCCESS` | 验证注册是否成功 | 检查登录状态 |
| `SUCCESS` | 注册成功 | 终态，成功回调 |
| `FAILED` | 注册失败 | 终态，失败回调 |
| `ERROR` | 发生错误 | 终态，错误处理 |

##### 验证码处理机制

验证码处理采用增强监控系统：

1. **智能检测**: 自动识别滑动验证码、图像验证码、拼图验证码等
2. **实时监控**: 1秒间隔检查验证码完成状态
3. **超时管理**: 默认5分钟超时，可配置
4. **用户通知**: 弱提示方式通知用户操作，不干扰用户体验

##### 实现文件结构

```
src/services/automation/
├── simple_state_machine.py             # 核心状态机逻辑（transitions框架）
├── captcha_handler.py                  # 验证码处理器
└── playwright_backend.py               # Transitions框架驱动的后端
```